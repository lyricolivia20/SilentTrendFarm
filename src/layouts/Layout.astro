---
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';

export interface Props {
	title: string;
	description: string;
	image?: string;
}

const { title, description, image = '/og-default.png' } = Astro.props;
const currentYear = new Date().getFullYear();
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!DOCTYPE html>
<html lang="en" class="dark">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="robots" content="index, follow" />
		<meta name="author" content="LyriCodes" />
		<meta name="keywords" content="indie game development, AI, machine learning, web development, VR, AR, programming, tutorials, LyriCodes" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="canonical" href={canonicalURL} />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Open Graph / Social -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={canonicalURL} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={image} />
		<meta property="og:site_name" content="LyriCodes" />
		<meta property="og:locale" content="en_US" />
		
		<!-- Twitter Card -->
		<meta property="twitter:card" content="summary_large_image" />
		<meta property="twitter:title" content={title} />
		<meta property="twitter:description" content={description} />
		<meta property="twitter:image" content={image} />
		
		<!-- Additional SEO -->
		<meta name="theme-color" content="#18181b" />
		<link rel="sitemap" href="/sitemap-index.xml" />
		
		<!-- Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
		
		<title>{title}</title>
		
		<!-- View Transitions for smooth navigation -->
		<ViewTransitions />
	</head>
	<body class="bg-zinc-950 text-zinc-100 font-sans antialiased">
		<!-- Subtle grid background (8px based: 64px = 8x8) -->
		<div class="fixed inset-0 bg-[linear-gradient(rgba(39,39,42,0.2)_1px,transparent_1px),linear-gradient(90deg,rgba(39,39,42,0.2)_1px,transparent_1px)] bg-[size:64px_64px] pointer-events-none"></div>
		
		<!-- Floating particles -->
		<div class="particles-container" id="particles"></div>
		
		<!-- Subtle scanlines for CRT vibe -->
		<div class="scanlines"></div>
		
		<div class="relative z-10">
			<header class="border-b border-zinc-800/50 bg-zinc-950/80 backdrop-blur-sm sticky top-0 z-50" transition:persist>
				<div class="max-w-5xl mx-auto px-6 py-5">
					<div class="flex items-center justify-between">
						<a href="/" class="inline-flex items-center gap-3 group">
							<div class="w-9 h-9 bg-zinc-800 border border-zinc-700 rounded-lg flex items-center justify-center logo-icon">
								<span class="text-zinc-300 font-mono font-bold text-sm">LC</span>
							</div>
							<div>
								<h1 class="text-lg font-semibold text-zinc-100 tracking-tight font-display">LyriCodes</h1>
								<p class="text-xs text-zinc-600 font-mono">field notes</p>
							</div>
						</a>
						
						<!-- Desktop Nav -->
						<nav class="hidden md:flex items-center gap-6">
							<a href="/tools" class="text-sm text-zinc-400 hover:text-amber-400 hover:text-xl hover:scale-125 transition-all duration-200 font-mono origin-center">tools</a>
							<a href="/stack" class="text-sm text-zinc-400 hover:text-rose-400 hover:text-xl hover:scale-125 transition-all duration-200 font-mono origin-center">stack</a>
							<a href="/about" class="text-sm text-zinc-400 hover:text-zinc-100 hover:text-xl hover:scale-125 transition-all duration-200 font-mono origin-center">about</a>
						</nav>
						
						<!-- Mobile Menu Button -->
						<button id="mobile-menu-btn" class="md:hidden p-2 text-zinc-400 hover:text-zinc-100 transition-colors" aria-label="Toggle menu">
							<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
							</svg>
						</button>
					</div>
					
					<!-- Mobile Nav -->
					<nav id="mobile-menu" class="hidden md:hidden pt-4 pb-2 border-t border-zinc-800/50 mt-4">
						<div class="flex flex-col gap-3">
							<a href="/tools" class="text-sm text-zinc-400 hover:text-amber-400 transition-colors font-mono py-2">tools</a>
							<a href="/stack" class="text-sm text-zinc-400 hover:text-rose-400 transition-colors font-mono py-2">stack</a>
							<a href="/about" class="text-sm text-zinc-400 hover:text-zinc-100 transition-colors font-mono py-2">about</a>
						</div>
					</nav>
				</div>
			</header>
			
			<script>
				document.getElementById('mobile-menu-btn')?.addEventListener('click', () => {
					document.getElementById('mobile-menu')?.classList.toggle('hidden');
				});

				// Create floating particles
				const particlesContainer = document.getElementById('particles');
				if (particlesContainer) {
					const colors = ['#34d399', '#22d3ee', '#a78bfa'];
					for (let i = 0; i < 15; i++) {
						const particle = document.createElement('div');
						particle.className = 'particle';
						particle.style.left = Math.random() * 100 + '%';
						particle.style.color = colors[Math.floor(Math.random() * colors.length)];
						particle.style.animationDelay = Math.random() * 15 + 's';
						particle.style.animationDuration = (12 + Math.random() * 8) + 's';
						particlesContainer.appendChild(particle);
					}
				}

				// Konami Code Easter Egg: â†‘â†‘â†“â†“â†â†’â†â†’BA
				const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
				let konamiIndex = 0;
				let glowModeActive = false;

				document.addEventListener('keydown', (e) => {
					if (e.code === konamiCode[konamiIndex]) {
						konamiIndex++;
						if (konamiIndex === konamiCode.length) {
							konamiIndex = 0;
							glowModeActive = !glowModeActive;
							document.body.classList.toggle('glow-mode', glowModeActive);
							
							// Show a little message
							const msg = document.createElement('div');
							msg.textContent = glowModeActive ? 'âœ¨ GLOW MODE ACTIVATED âœ¨' : 'ðŸ’¤ glow mode off';
							msg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(24,24,27,0.95);border:1px solid #34d399;padding:16px 32px;border-radius:8px;font-family:monospace;color:#34d399;z-index:10000;animation:fadeOut 2s forwards';
							document.body.appendChild(msg);
							setTimeout(() => msg.remove(), 2000);
						}
					} else {
						konamiIndex = 0;
					}
				});

				// Add fadeOut animation
				const style = document.createElement('style');
				style.textContent = '@keyframes fadeOut { 0% { opacity: 1; } 100% { opacity: 0; } }';
				document.head.appendChild(style);

				// Cursor light + sparkle trail effect
				const cursorLight = document.createElement('div');
				cursorLight.id = 'cursor-light';
				cursorLight.style.cssText = `
					position: fixed;
					width: 500px;
					height: 500px;
					border-radius: 50%;
					pointer-events: none;
					z-index: 0;
					background: radial-gradient(circle, rgba(52, 211, 153, 0.15) 0%, rgba(34, 211, 238, 0.08) 25%, rgba(167, 139, 250, 0.04) 50%, transparent 70%);
					transform: translate(-50%, -50%);
					will-change: left, top;
				`;
				document.body.appendChild(cursorLight);

				// Sparkle container
				const sparkleContainer = document.createElement('div');
				sparkleContainer.style.cssText = 'position:fixed;inset:0;pointer-events:none;z-index:9998;overflow:hidden;';
				document.body.appendChild(sparkleContainer);

				const sparkleChars = ['âœ¦', 'âœ§', 'â‹†', 'Ëš', 'Â·', '0', '1', 'âœ¶', 'âœ´', 'âœ¹'];
				const sparkleColors = ['#34d399', '#22d3ee', '#a78bfa', '#ffffff', '#fcd34d'];
				let lastSparkleTime = 0;
				let mouseX = 0, mouseY = 0;

				document.addEventListener('mousemove', (e) => {
					mouseX = e.clientX;
					mouseY = e.clientY;
					
					// Direct positioning - no lag
					cursorLight.style.left = mouseX + 'px';
					cursorLight.style.top = mouseY + 'px';

					// Spawn sparkles (throttled) - spawn 2-3 at a time
					const now = Date.now();
					if (now - lastSparkleTime > 30) {
						lastSparkleTime = now;
						const count = Math.random() > 0.5 ? 2 : 3;
						for (let i = 0; i < count; i++) {
							createSparkle(mouseX, mouseY);
						}
					}
				});

				function createSparkle(x: number, y: number) {
					const sparkle = document.createElement('span');
					sparkle.textContent = sparkleChars[Math.floor(Math.random() * sparkleChars.length)];
					sparkle.style.cssText = `
						position: fixed;
						left: ${x + (Math.random() - 0.5) * 30}px;
						top: ${y + (Math.random() - 0.5) * 30}px;
						color: ${sparkleColors[Math.floor(Math.random() * sparkleColors.length)]};
						font-size: ${8 + Math.random() * 10}px;
						pointer-events: none;
						opacity: 1;
						transform: scale(1);
						transition: all 0.6s ease-out;
						text-shadow: 0 0 4px currentColor;
					`;
					sparkleContainer.appendChild(sparkle);

					// Animate out
					requestAnimationFrame(() => {
						sparkle.style.opacity = '0';
						sparkle.style.transform = `scale(0) translateY(${-20 - Math.random() * 30}px)`;
					});

					// Remove after animation
					setTimeout(() => sparkle.remove(), 600);
				}

				// Hide light when mouse leaves
				document.addEventListener('mouseleave', () => {
					cursorLight.style.opacity = '0';
				});
				document.addEventListener('mouseenter', () => {
					cursorLight.style.opacity = '1';
				});
			</script>

			<main class="max-w-5xl mx-auto px-6 py-12">
				<slot />
			</main>

			<footer class="border-t border-zinc-800/50 mt-20">
				<div class="max-w-5xl mx-auto px-6 py-12">
					<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
						<div class="text-sm text-zinc-500 space-y-2">
							<p class="font-mono text-zinc-400 font-semibold">LyriCodes <span class="text-emerald-500/70">Field Notes</span></p>
							<p class="text-zinc-600 max-w-md">A collection of guides and insights for aspiring developers, digital artists, and creators.</p>
						</div>
						<div class="flex items-center gap-4">
							<a href="/rss.xml" class="text-zinc-500 hover:text-emerald-400 transition-colors footer-link" title="RSS Feed">
								<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
									<path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"/>
								</svg>
							</a>
							<a href="https://github.com" target="_blank" rel="noopener" class="text-zinc-500 hover:text-zinc-100 transition-colors footer-link" title="GitHub">
								<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
									<path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
								</svg>
							</a>
						</div>
					</div>
					<div class="mt-8 pt-6 border-t border-zinc-800/50">
						<p class="text-zinc-700 font-mono text-xs">&copy; {currentYear} LyriCodes</p>
					</div>
				</div>
			</footer>
		</div>
	</body>
</html>
