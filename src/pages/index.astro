---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');
const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const indieDevPosts = sortedPosts.filter(post => post.data.category === 'indie-dev');
const aiMlPosts = sortedPosts.filter(post => post.data.category === 'ai-ml');
const itTechPosts = sortedPosts.filter(post => post.data.category === 'it-tech');

const categoryColors = {
	'indie-dev': { accent: 'emerald', border: 'emerald-500/30', text: 'emerald-400', bg: 'emerald-500/10' },
	'ai-ml': { accent: 'cyan', border: 'cyan-500/30', text: 'cyan-400', bg: 'cyan-500/10' },
	'it-tech': { accent: 'violet', border: 'violet-500/30', text: 'violet-400', bg: 'violet-500/10' },
};
---

<Layout title="LyriCodes Field Notes — Guides & Insights" description="A collection of field notes for aspiring developers, digital artists, and creators navigating the world of independent development.">
	<!-- Sticky Right Sidebar Nav (Desktop only) -->
	<nav id="section-nav" class="hidden lg:flex fixed right-4 top-1/2 -translate-y-1/2 flex-col items-end gap-2 z-40">
		<!-- Top collapse line -->
		<div class="nav-line-top w-px h-6 bg-gradient-to-b from-transparent to-zinc-700 transition-all duration-500"></div>
		
		<a href="#indie-dev" data-section="indie-dev" class="section-nav-link transition-all duration-500 ease-out text-right cursor-pointer">
			<span class="nav-label font-mono whitespace-nowrap tracking-tight transition-all duration-300 text-sm">indie_dev</span>
		</a>
		<a href="#ai-ml" data-section="ai-ml" class="section-nav-link transition-all duration-500 ease-out text-right cursor-pointer">
			<span class="nav-label font-mono whitespace-nowrap tracking-tight transition-all duration-300 text-sm">ai_ml</span>
		</a>
		<a href="#it-tech" data-section="it-tech" class="section-nav-link transition-all duration-500 ease-out text-right cursor-pointer">
			<span class="nav-label font-mono whitespace-nowrap tracking-tight transition-all duration-300 text-sm">it_tech</span>
		</a>
		
		<!-- Bottom collapse line -->
		<div class="nav-line-bottom w-px h-6 bg-gradient-to-t from-transparent to-zinc-700 transition-all duration-500"></div>
	</nav>

	<div class="space-y-20">
		<!-- Hero section -->
		<section class="py-8">
			<h2 class="text-4xl md:text-5xl font-bold text-zinc-100 mb-6 font-display leading-tight">
				LyriCodes<br/>
				<span class="bg-gradient-to-r from-emerald-400 via-cyan-400 to-violet-400 bg-clip-text text-transparent">Field Notes</span>
			</h2>
			<p class="text-lg text-zinc-400 leading-relaxed max-w-3xl">
				A collection of guides and insights for aspiring developers, digital artists, and creators navigating the complex and exhilarating world of independent development. This is a space for the DIY ethos, for those of us piecing together vast digital worlds with passion, persistence, and a healthy dose of Stack Overflow.
			</p>
		</section>

		<!-- Section 1: The Indie Dev's Playbook -->
		<section id="indie-dev">
			<div class="flex items-center gap-3 mb-3">
				<span class="text-emerald-400 font-mono text-sm">01</span>
				<div class="flex-1 h-px bg-gradient-to-r from-emerald-500/50 to-transparent"></div>
			</div>
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-zinc-100 font-display mb-2">The Indie Dev's Playbook</h2>
				<p class="text-zinc-500 text-sm">From Concept to Code — worldbuilding, engine choices, and technical troubleshooting.</p>
			</div>
			
			<div class="grid md:grid-cols-2 gap-4">
				{indieDevPosts.map((post, index) => (
					<article class="group">
						<a href={`/posts/${post.slug}/`} class="block h-full p-5 rounded-xl border border-zinc-800/50 bg-zinc-900/30 hover:border-emerald-500/30 hover:bg-emerald-500/5 transition-all">
							<div class="flex items-start gap-3">
								<span class="text-emerald-500/50 font-mono text-xs mt-1">{String(index + 1).padStart(2, '0')}</span>
								<div class="flex-1">
									{post.data.tags && post.data.tags.length > 0 && (
										<div class="flex flex-wrap gap-1.5 mb-2">
											{post.data.tags.slice(0, 2).map((tag) => (
												<span class="text-[10px] px-2 py-0.5 bg-emerald-500/10 text-emerald-400 rounded font-mono">{tag}</span>
											))}
										</div>
									)}
									<h3 class="text-base font-semibold text-zinc-100 group-hover:text-emerald-400 transition-colors mb-2 leading-snug">
										{post.data.title}
									</h3>
									<p class="text-zinc-500 text-sm leading-relaxed line-clamp-2">{post.data.description}</p>
								</div>
							</div>
						</a>
					</article>
				))}
			</div>
		</section>

		<!-- Section 2: ML Diaries -->
		<section id="ai-ml">
			<div class="flex items-center gap-3 mb-3">
				<span class="text-cyan-400 font-mono text-sm">02</span>
				<div class="flex-1 h-px bg-gradient-to-r from-cyan-500/50 to-transparent"></div>
			</div>
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-zinc-100 font-display mb-2">ML Diaries</h2>
				<p class="text-zinc-500 text-sm">Practical AI & ML Projects — from training models to prompt engineering.</p>
			</div>
			
			<div class="grid md:grid-cols-2 gap-4">
				{aiMlPosts.map((post, index) => (
					<article class="group">
						<a href={`/posts/${post.slug}/`} class="block h-full p-5 rounded-xl border border-zinc-800/50 bg-zinc-900/30 hover:border-cyan-500/30 hover:bg-cyan-500/5 transition-all">
							<div class="flex items-start gap-3">
								<span class="text-cyan-500/50 font-mono text-xs mt-1">{String(index + 1).padStart(2, '0')}</span>
								<div class="flex-1">
									{post.data.tags && post.data.tags.length > 0 && (
										<div class="flex flex-wrap gap-1.5 mb-2">
											{post.data.tags.slice(0, 2).map((tag) => (
												<span class="text-[10px] px-2 py-0.5 bg-cyan-500/10 text-cyan-400 rounded font-mono">{tag}</span>
											))}
										</div>
									)}
									<h3 class="text-base font-semibold text-zinc-100 group-hover:text-cyan-400 transition-colors mb-2 leading-snug">
										{post.data.title}
									</h3>
									<p class="text-zinc-500 text-sm leading-relaxed line-clamp-2">{post.data.description}</p>
								</div>
							</div>
						</a>
					</article>
				))}
			</div>
		</section>

		<!-- Section 3: Troubleshoot.exe -->
		<section id="it-tech">
			<div class="flex items-center gap-3 mb-3">
				<span class="text-violet-400 font-mono text-sm">03</span>
				<div class="flex-1 h-px bg-gradient-to-r from-violet-500/50 to-transparent"></div>
			</div>
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-zinc-100 font-display mb-2">Troubleshoot.exe</h2>
				<p class="text-zinc-500 text-sm">IT & Tech Troubleshooting — demystifying and solving common technology problems.</p>
			</div>
			
			<div class="grid md:grid-cols-2 gap-4">
				{itTechPosts.map((post, index) => (
					<article class="group">
						<a href={`/posts/${post.slug}/`} class="block h-full p-5 rounded-xl border border-zinc-800/50 bg-zinc-900/30 hover:border-violet-500/30 hover:bg-violet-500/5 transition-all">
							<div class="flex items-start gap-3">
								<span class="text-violet-500/50 font-mono text-xs mt-1">{String(index + 1).padStart(2, '0')}</span>
								<div class="flex-1">
									{post.data.tags && post.data.tags.length > 0 && (
										<div class="flex flex-wrap gap-1.5 mb-2">
											{post.data.tags.slice(0, 2).map((tag) => (
												<span class="text-[10px] px-2 py-0.5 bg-violet-500/10 text-violet-400 rounded font-mono">{tag}</span>
											))}
										</div>
									)}
									<h3 class="text-base font-semibold text-zinc-100 group-hover:text-violet-400 transition-colors mb-2 leading-snug">
										{post.data.title}
									</h3>
									<p class="text-zinc-500 text-sm leading-relaxed line-clamp-2">{post.data.description}</p>
								</div>
							</div>
						</a>
					</article>
				))}
			</div>
		</section>

		<!-- About Section -->
		<section class="border-t border-zinc-800/50 pt-16">
			<div class="max-w-2xl">
				<h2 class="text-xl font-bold text-zinc-100 font-display mb-4">About These Field Notes</h2>
				<p class="text-zinc-400 leading-relaxed mb-4">
					The guides you'll find here are born from real-world trial and error, covering the entire creative stack—from the initial spark of an idea and deep worldbuilding to the inevitable technical troubleshooting that follows.
				</p>
				<p class="text-zinc-500 leading-relaxed">
					We explore game design, engine choices, common coding pitfalls, AI tools, prompt engineering, and the diverse skills needed to bring a project to life. Our journey begins where all great projects do: with curiosity and the willingness to learn.
				</p>
			</div>
		</section>
	</div>

	<!-- Scroll Spy Script -->
	<script>
		const sections = ['indie-dev', 'ai-ml', 'it-tech'];
		const navLinks = document.querySelectorAll('.section-nav-link');
		
		const colorMap: Record<string, string> = {
			'indie-dev': '#34d399', // emerald-400
			'ai-ml': '#22d3ee',     // cyan-400
			'it-tech': '#a78bfa'    // violet-400
		};

		let currentActive: string | null = null;

		function setActiveSection(sectionId: string) {
			if (currentActive === sectionId) return;
			currentActive = sectionId;

			// Animate collapse lines based on active section
			const topLine = document.querySelector('.nav-line-top') as HTMLElement;
			const bottomLine = document.querySelector('.nav-line-bottom') as HTMLElement;
			
			if (topLine && bottomLine) {
				const activeIndex = sections.indexOf(sectionId);
				// Collapse lines toward active section
				if (activeIndex === 0) {
					topLine.style.height = '0.5rem';
					bottomLine.style.height = '3rem';
				} else if (activeIndex === 2) {
					topLine.style.height = '3rem';
					bottomLine.style.height = '0.5rem';
				} else {
					topLine.style.height = '2rem';
					bottomLine.style.height = '2rem';
				}
				// Color the lines based on active section
				topLine.style.background = `linear-gradient(to bottom, transparent, ${colorMap[sectionId]})`;
				bottomLine.style.background = `linear-gradient(to top, transparent, ${colorMap[sectionId]})`;
			}

			navLinks.forEach(link => {
				const linkSection = link.getAttribute('data-section');
				const label = link.querySelector('.nav-label') as HTMLElement;
				if (!label || !linkSection) return;
				
				if (linkSection === sectionId) {
					// Active state: bigger, colored, glowing, popped out to the LEFT
					link.classList.add('-translate-x-1');
					label.style.color = colorMap[sectionId];
					label.style.textShadow = `0 0 12px ${colorMap[sectionId]}, 0 0 24px ${colorMap[sectionId]}`;
					label.style.fontSize = '1.125rem';
					label.style.fontWeight = '600';
				} else {
					// Inactive state: smaller, dim, no glow
					link.classList.remove('-translate-x-1');
					label.style.color = '#52525b'; // zinc-600
					label.style.textShadow = 'none';
					label.style.fontSize = '0.875rem';
					label.style.fontWeight = '400';
				}
			});
		}

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					setActiveSection(entry.target.id);
				}
			});
		}, {
			rootMargin: '-30% 0px -60% 0px',
			threshold: 0
		});

		sections.forEach(sectionId => {
			const section = document.getElementById(sectionId);
			if (section) observer.observe(section);
		});

		// Hover effects for inactive items
		navLinks.forEach(link => {
			const linkSection = link.getAttribute('data-section');
			const label = link.querySelector('.nav-label') as HTMLElement;
			if (!label || !linkSection) return;

			link.addEventListener('mouseenter', () => {
				if (currentActive !== linkSection) {
					label.style.color = colorMap[linkSection];
					label.style.fontSize = '1rem';
				}
			});

			link.addEventListener('mouseleave', () => {
				if (currentActive !== linkSection) {
					label.style.color = '#52525b';
					label.style.fontSize = '0.875rem';
				}
			});
		});

		// Initialize first section as active on load
		setActiveSection('indie-dev');
	</script>
</Layout>
